<html>
  <head>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scaleable=no' name='viewport' />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .error {
        background: red;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}var canvas=document.createElement('canvas');document.body.appendChild(canvas);var targets={canvas:canvas,context2D:canvas.getContext('2d')};var constructors={Image:Image};var flattenObject=function flattenObject(object){if(typeof object!=='object'){return object;}var flatObject={};for(var key in object){flatObject[key]=object[key];}for(var _key in Object.getOwnPropertyNames(object)){flatObject[_key]=object[_key];}return flatObject;};var toMessage=function toMessage(result){if(result instanceof Blob){return{type:'blob',payload:btoa(result)};}return{type:'json',payload:flattenObject(result)};};var populateRefs=function populateRefs(arg){if(arg.__ref__){return targets[arg.__ref__];}return arg;};document.addEventListener('message',function(e){var _JSON$parse=JSON.parse(e.data),id=_JSON$parse.id,type=_JSON$parse.type,payload=_JSON$parse.payload;try{switch(type){case'exec':{var _targets$target;var target=payload.target,method=payload.method,args=payload.args;var result=(_targets$target=targets[target])[method].apply(_targets$target,_toConsumableArray(args.map(populateRefs)));var message=toMessage(result);postMessage(JSON.stringify(_extends({id:id},message)));break;}case'set':{var _target=payload.target,key=payload.key,value=payload.value;targets[_target][key]=value;break;}case'construct':{var _constructor=payload.constructor,_target2=payload.id,_payload$args=payload.args,_args=_payload$args===undefined?[]:_payload$args;var object=new(Function.prototype.bind.apply(constructors[_constructor],[null].concat(_toConsumableArray(_args))))();var _message=toMessage({});targets[_target2]=object;postMessage(JSON.stringify(_extends({id:id},_message)));break;}case'listen':{var types=payload.types,_target3=payload.target;for(var _iterator=types,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var eventType=_ref;targets[_target3].addEventListener(eventType,function(e){var message=toMessage({type:'event',payload:{type:e.type}});postMessage(JSON.stringify(_extends({id:id},message)));});}break;}}}catch(err){document.body.innerHTML='<div class="error">'+err+'</div>';}});
    </script>
  </body>
</html>
